	processor 6502
        include "vcs.h"
        include "macro.h"
        include "xmacro.h"

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;
; Ejemplo de playfield asíncrono de dos colores 
; y linea negra cada 8 líneas para Mustache Boy
;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

        seg.u Variables
	org $80
	seg Code
        org $f000

Start
	CLEAN_START

NextFrame
	VERTICAL_SYNC

	TIMER_SETUP 42
; Set playfield foreground and background
        lda #$00
        sta COLUBK
        lda #$52
        sta COLUPF
        TIMER_WAIT

        ldy #240
ScanLoop
; WSYNC and store playfield registers
	sta WSYNC
        lda Colores,y
	sta COLUPF
	lda PFBitmap0,y
        sta PF0		; store first playfield byte
	lda PFBitmap1,y
        sta PF1		; store 2nd byte
	lda PFBitmap2,y
        sta PF2		; store 3rd byte
; Here's the asymmetric part -- by this time the TIA clock
; is far enough that we can rewrite the same PF registers
; and display new data on the right side of the screen
	
	lda PFBitmap3,y
        sta PF0		; store 4th byte
	lda PFBitmap4,y
        sta PF1		; store 5th byte
	lda PFBitmap5,y
        sta PF2		; store 6th byte
        dey 
        bne ScanLoop	; repeat until all scanlines drawn
; Reset playfield
	SLEEP 14	; give time to finish drawing scanline
	lda #0
        sta PF0
        sta PF1
        sta PF2		; clear playfield

	TIMER_SETUP 25
        TIMER_WAIT
        jmp NextFrame



PFBitmap0 ; Primeros 4 píxeles a la izquierda - X0
	hex 00
        hex 00000000000000000000000000000000
        hex 00000000000000000000000000000000
       	hex 00000000000000000000000000000000
        hex 00000000000000000000000000000000
       	hex 00000000000000000000000000000000
        hex 00000000000000000000000000000000
       	hex 00000000000000000000000000000000
        hex 00000000000000000000000000000000
       	hex 00000000000000000000000000000000
        hex 00000000000000000000000000000000
       	hex 00000000000000000000000000000000
        hex 00000000000000000000000000000000
       	hex 00000000000000000000000000000000
        hex 00000000000000000000000000000000
       	hex 00000000000000000000000000000000
PFBitmap1 ; Segundos 8 píxeles a la izquierda
	hex 00
	hex 00000100000000000002000000000000
        hex 00000100000000000002000000000000
       	hex 00000100000000000002000000000000
        hex 00000100000000000002000000000000
       	hex 00000100000000000002000000000000
        hex 00000100000000000002000000000000
       	hex 00000100000000000002000000000000
        hex 00030303030303030303030303030303
       	hex 00000300030003000300030003000300
        hex 00000300030003000300030003000300
       	hex 00000300030003000300030003000300
        hex 00000300030003000300030003000300
       	hex 00000300030003000300030003000300
        hex 00000000000000000000000000000000
        hex 00000000000000000000000000000000
       	
PFBitmap2 ; Terceros 8 píxeles a la izquierda - Invertido
	hex 00
	hex 000efe0efe0efe0efe0efe0efe0efe0e
        hex 008efe8efe8efe8efe8efe8efe8efe8e
       	hex 008efe8efe8efe8efe8efe8efe8efe8e
        hex 008efe8efe8efe8efe8efe8efe8efe8e
       	hex 008efe8efe8efe8efe8efe8efe8efe8e
        hex 008efe8efe8efe8efe8efe8efe8efe8e
       	hex 008efe8efe8efe8efe8efe8efe8efe8e
        hex 008fff8fff8fff8fff8fff8fff8fff8f
       	hex 0000ff00ff00ff00ff00ff00ff00ff00
        hex 0000ff00ff00ff00ff00ff00ff00ff00
       	hex 0000df208f708f708f70df20bf40ff00
        hex 0000ff00ff00ff00ff00ff00ff00ff00
       	hex 0000ff00ff00ff00ff00ff00ff00ff00
        hex 00000000000000000000000000000000
        hex 00000000000000000000000000000000
PFBitmap3 ; Repite - 4 píxeles - X0
	hex 00
	hex 0000f000f000f000f000f000f000f000
        hex 00f0f0f0e0f0e0f0e0f0e0f0e0f0f0f0
       	hex 0030b030303030303070303030303030
        hex 0030b030303030303070303030303030
       	hex 0030b030303030303070303030303030
        hex 0030b030303030303070303030303030
       	hex 0030b030303030303070303030303030
        hex 00f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0
       	hex 0000f000f000f000f000f000f000f000
        hex 0000f000f000f000f000f000f000f000
       	hex 0000f000f000f000f000f000f000f000
        hex 0000f000f000f000f000f000f000f000
       	hex 0000f000f000f000f000f000f000f000
        hex 00000000000000000000000000000000
        hex 00000000000000000000000000000000
PFBitmap4 ; Repite - Penúltimos 8 píxeles
	hex 00
	hex 0000ff00ff00ff00ff00ff00ff00ff00
	hex 00ffffffffffffffffffffffffffffff
	hex 00012501010101010149010101010101
	hex 00002400000000000049000000000000
	hex 00002400000000000049000000000000
	hex 00002400000000000049000000000000
	hex 00002400000000000049000000000000
	hex 00f0f4f0f0f0f0f0f0f9f0f0f0f0f0f0
	hex 0070f470f070f070f079f070f070f070
	hex 007fff7fff7fff7fff7fff7fff7fff7f
	hex 0000fe01fe01fe01fe01fe01fe01fe01
	hex 007eff7efb7efb7efb7efb7efb7eff7e
	hex 007eff7eff7eff7eff7eff7eff7eff7e
        hex 00000000000000000000000000000000
        hex 00000000000000000000000000000000
PFBitmap5 ; repite - ültimos 8 píxeles - Invertido
	hex 00
	hex 00fc03fc03fc03fc03fc03fc03fc03fc
	hex 0003ff03ff03ff03ff03ff03ff03ff03
	hex 001fff1fff1fff1fff1fff1fff1fff1f
	hex 001cfd1cfc1cfc1cfc1cfc1cfc1cfc1c
	hex 001cfd1cfc1cfc1cfc1cfc1cfc1cfc1c
	hex 001cfd1cfc1cfc1cfc1cfc1cfc1cfc1c
	hex 001cfd1cfc1cfc1cfc1cfc1cfc1cfc1c
	hex 001cfd1cfc1cfc1cfc1cfc1cfc1cfc1c
	hex 001cfd1cfc1cfc1cfc1cfc1cfc1cfc1c
	hex 001fff1ff71ff71ff71ff71ff71fff1f
	hex 0000ff00ff00ff00fe01fd02fd02fe01
	hex 00fcfffcf7fcf7fcf7fcf7fcf7fcfffc
	hex 001c5f1c1f1c1f1c1f3c1f1c1f1c1f1c
        hex 00000000000000000000000000000000
        hex 00000000000000000000000000000000
Colores
	hex 00
        hex a658a658a658a658a658a658a658a658
        hex a658a658a658a658a658a658a658a658
        hex a658a658a658a658a658a658a658a658
        hex a658a658a658a658a658a658a658a658
        hex a658a658a658a658a658a658a658a658
        hex a658a658a658a658a658a658a658a658
        hex a658a658a658a658a658a658a658a658
        hex a658a658a658a658a658a658a658a658
        hex a658a658a658a658a658a658a658a658
        hex a658a658a658a658a658a658a658a658
        hex a658a658a658a658a658a658a658a658
        hex a658a658a658a658a658a658a658a658
        hex a658a658a658a658a658a658a658a658
        hex a658a658a658a658a658a658a658a658
        hex a658a658a658a658a658a658a658a658
        
        

; Epilogue
	org $fffc
        .word Start
        .word Start