	processor 6502
        include "vcs.h"
        include "macro.h"
        include "xmacro.h"

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;
; Ejemplo de playfield asíncrono de dos colores 
; y linea negra cada 8 líneas para Mustache Boy
;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

        seg.u Variables
	org $80
	seg Code
        org $f000
2
Start
	CLEAN_START

NextFrame
	VERTICAL_SYNC

	TIMER_SETUP 42
; Set playfield foreground and background
        lda #$00
        sta COLUBK
        lda #$52
        sta COLUPF
        TIMER_WAIT

        ldy #240
ScanLoop
; WSYNC and store playfield registers
	sta WSYNC
        lda Colores,y
	sta COLUPF
	lda PFBitmap0,y
        sta PF0		; store first playfield byte
	lda PFBitmap1,y
        sta PF1		; store 2nd byte
	lda PFBitmap2,y
        sta PF2		; store 3rd byte
; Here's the asymmetric part -- by this time the TIA clock
; is far enough that we can rewrite the same PF registers
; and display new data on the right side of the screen
	
	lda PFBitmap3,y
        sta PF0		; store 4th byte
	lda PFBitmap4,y
        sta PF1		; store 5th byte
	lda PFBitmap5,y
        sta PF2		; store 6th byte
        dey 
        bne ScanLoop	; repeat until all scanlines drawn
; Reset playfield
	SLEEP 14	; give time to finish drawing scanline
	lda #0
        sta PF0
        sta PF1
        sta PF2		; clear playfield

	TIMER_SETUP 25
        TIMER_WAIT
        jmp NextFrame

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; BITMAP DATA - Ada Lovelace

PFBitmap0
	hex 00
        hex 00000000000000000000000000000000
        hex 00000000000000000000000000000000
       	hex 00002000000000400000001000008000
        hex 00002000000000400000001000008000
	hex 00002000000000400000001000008000
	hex 00002000000000400000001000008000
	hex 00002000000000400000001000008000
	hex 00002000000000400000001000008000
	hex 00002000000000400000001000008000
	hex 00f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0
	hex 0000f000f000f000f000f000f000f000
	hex 0000f000f000f000f000f000f000f000
	hex 0000f000f000f000f000f000f000f000
        hex 0000f000f000f000f000f000f000f000
        hex 0000f000f000f000f000f000f000f000
PFBitmap1
	hex 00
	hex 67675252525262625252565662620000
        hex 67675252525262625252565662620000
        hex 00f0fff0fff0fff0fff0fff0fff0fff0
	hex 00f0fff0fff0fff0fff0fff0fff0fff0
	hex 00f0fff0fff0fff0fff0fff0fff0fff0
	hex 00f0fff0fff0fff0fff0fff0fff0fff0
	hex 00f0fff0fff0fff0fff0fff0fff0fff0
	hex 00f0fff0fff0fff0fff0fff0fff0fff0
	hex 00f0fff0fff0fff0fff0fff0fff0fff0
	hex 00f0fff0fff0fff0fff0fff0fff0fff0
        hex 0000ff00ff00ff00ff00ff00ff00ff00
	hex 0000ff00ff00ff00ff00ff00ff00ff00
	hex 0000ff00fb04f10Ef10Ef10Efb04fd02
        hex 0000ff00ff00ff00ff00ff00ff00ff00
	hex 0000ff00ff00ff00ff00ff00ff00ff00
PFBitmap2
	hex 00
        hex eeee82828282eeee88888888eeee0000
        hex eeee82828282eeee88888888eeee0000
	hex 0000ff00ff00ff00ff00ff00ff00ff00
        hex 00fffffff9fff9fff9fff9fff9ffffff
	hex 000f2f0f0f0f0f4f0f0f0f1f0f0f8f0f
	hex 000f2f0f0f0f0f4f0f0f0f1f0f0f8f0f
	hex 000f2f0f0f0f0f4f0f0f0f1f0f0f8f0f
	hex 000f2f0f0f0f0f4f0f0f0f1f0f0f8f0f
	hex 000f2f0f0f0f0f4f0f0f0f1f0f0f8f0f
	hex 00ffffffffffffffffffffffffffffff
	hex 0000ff00ff00ff00ff00ff00ff00ff00
	hex 0000ff00ff00ff00ff00ff00ff00ff00
	hex 0000ff00ff00ff00ff00ff00ff00ff00
        hex 0000ff00ff00ff00ff00ff00ff00ff00
	hex 0000ff00ff00ff00ff00ff00ff00ff00
PFBitmap3
	hex 00
	hex 00000000000000000000000000000000
        hex 00000000000000000000000000000000
	hex 0000f000f000f000f000f000f000f000
	hex 00f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0
	hex 00002000000000400000001000008000
	hex 00002000000000400000001000008000
	hex 00002000000000400000001000008000
	hex 00002000000000400000001000008000
	hex 00002000000000400000001000008000
	hex 00f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0
	hex 00f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0
	hex 00f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0
	hex 0000f000f000f000f000f000f000f000
        hex 00f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0
	hex 00f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0
PFBitmap4
	hex 00
	hex 27272424242427272121212177770000
        hex 27272424242427272121212177770000
	hex 0000ff00ff00ff00ff00ff00ff00ff00
	hex 00ffffffffffffffffffffffffffffff
	hex 000f4f0f0f0f0f2f0f0f0f8f0f0f1f0f
	hex 00004400000000220000008800001100
	hex 00004400000000220000008800001100
	hex 00004400000000220000008800001100
	hex 00004400000000220000008800001100
	hex 00004400000000220000008800001100
	hex 00004400000000220000008800001100
	hex 00ffffffffffffffffffffffffffffff
	hex 0000f708f708f708f30cf50af50af30c
	hex 00f0fff09ff09ff09ff09ff09ff0fff0
	hex 00f0fff0fff0fff0fff0fff0fff0fff0
PFBitmap5
	hex 00
	hex eeee8a8a8a8aeeeeaaaaaaaaeeee0000
        hex eeee8a8a8a8aeeeeaaaaaaaaeeee0000
	hex 00ff00ff00ff00ff00ff00ff00ff00ff
	hex 0000ff00ff00ff00ff00ff00ff00ff00
	hex 000fff0fff0fff0fff0fff0fff0fff0f
	hex 000fff0fff0fff0fff0fff0fff0fff0f
	hex 000fff0fff0fff0fff0fff0fff0fff0f
	hex 000fff0fff0fff0fff0fff0fff0fff0f
	hex 000fff0fff0fff0fff0fff0fff0fff0f
	hex 000fff0fff0fff0fff0fff0fff0fff0f
	hex 000fff0fff0fff0fff0fff0fff0fff0f
	hex 000fff0ff90ff90ff90ff90ff90fff0f
	hex 0000ff00ff00ff00ff00ff00ff00ff00
	hex 00fffffff9fff9fff9fff9fff9ffffff
	hex 000f2f0f0f0f0f4f0f0f0f1f0f0f8f0f
Colores
	hex 00
        hex 2c2c2c2c2c2c2c2c2c2c2c2c2c2c2c2c
        hex 2c2c2c2c2c2c2c2c2c2c2c2c2c2c2c2c
        hex a658a658a658a658a658a658a658a658
        hex a658a658a658a658a658a658a658a658
        hex a658a658a658a658a658a658a658a658
        hex a658a658a658a658a658a658a658a658
        hex a658a658a658a658a658a658a658a658
        hex a658a658a658a658a658a658a658a658
        hex a658a658a658a658a658a658a658a658
        hex a658a658a658a658a658a658a658a658
        hex a658a658a658a658a658a658a658a658
        hex a658a658a658a658a658a658a658a658
        hex a658a658a658a658a658a658a658a658
        hex a658a658a658a658a658a658a658a658
        hex a658a658a658a658a658a658a658a658
        
        

; Epilogue
	org $fffc
        .word Start
        .word Start
